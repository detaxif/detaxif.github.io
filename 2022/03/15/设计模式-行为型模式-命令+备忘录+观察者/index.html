<!DOCTYPE html>
<html lang="ch">
  <head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="yeung">







<title>设计模式-行为型模式-命令+备忘录+观察者 | YE&#39;s BLOG</title>



    <link rel="icon" href="/favicon.ico">



<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Roboto+Mono&display=swap');
</style>



    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    




    <!-- scripts list from _config.yml -->
    
    <script src="/js/frame.js"></script>
    







  <meta name="generator" content="Hexo 5.4.1"></head>
  <body>
    <div class="mask-border">
    </div>

    <div class="wrapper">

      <div class="header">
  <div class="flex-container">
    <div class="header-inner">
      <div class="site-brand-container">
        <a href="/">Ultralight Beam.</a>
      </div>
      <div id="menu-btn" class="menu-btn" onclick="toggleMenu()">
        Menu
      </div>
      <nav class="site-nav">
        <ul class="menu-list">
          
            
              <li class="menu-item">
                <a href="/">Home</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/archives/">Archives</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/about/">About</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/tag/">Tags</a>
              </li> 
                   
          
        </ul>
      </nav>
    </div>
  </div>
</div>


      <div class="main">
        <div class="flex-container">
          <article id="post">

  
    <div class="post-head">
    <div class="post-info">
        <div class="tag-list">
            
                
                    <span class="post-tag">
                        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
                            设计模式
                        </a>
                    </span>    
                           
            
        </div>
        <div class="post-title">
            
            
                设计模式-行为型模式-命令+备忘录+观察者
            
            
        </div>
        <span class="post-date">
            03 15, 2022
        </span>
    </div>
    <div class="post-img">
        
            <div class="h-line-primary"></div>
              
    </div>
</div>
    <div class="post-content">
    <h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><h2 id="行为型模式"><a href="#行为型模式" class="headerlink" title="行为型模式"></a>行为型模式</h2><h3 id="Command-命令模式"><a href="#Command-命令模式" class="headerlink" title="Command 命令模式"></a>Command 命令模式</h3><p>意图：将一个请求封装为一个对象，使发出请求的责任和执行请求的责任分割开，这样两者之间通过命令对象进行沟通，这样方便将命令对象进行存储、传递、调用、增加与管理。</p>
<p>结构：</p>
<ul>
<li>Command 抽象命令角色：定义命令的接口，声明执行的方法。</li>
<li>Concrete Command 具体命令角色：实现命令接口，通常会持有接收者，并调用接收者的功能来完成命令要执行的操作。</li>
<li>Receiver 接收者角色：真正执行命令的对象。</li>
<li>Invoker 调用者角色：要求命令对象执行请求，通常会持有命令对象，并可以持有多个命令。</li>
</ul>
<p>以餐厅下订单为例，服务员接到订单后要传给厨师：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//订单类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span>&#123;</span><br><span class="line">  <span class="comment">//餐桌号码</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> Table;</span><br><span class="line">  <span class="comment">//下的餐品及多少份</span></span><br><span class="line">  <span class="keyword">private</span> Map&lt;String,Integer&gt; food = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">  <span class="comment">//get set方法</span></span><br><span class="line">  <span class="comment">//其中setFood方法：</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFood</span><span class="params">(String name, <span class="type">int</span> num)</span>&#123;</span><br><span class="line">    food.put(name,num);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Receiver接收者类：厨师</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chef</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">makeFood</span><span class="params">(String name, Integer num)</span>&#123;</span><br><span class="line">    System.out.println(num+<span class="string">&quot;份&quot;</span>+name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Command抽象命令类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Command</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Concrete Command 具体命令类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span>&#123;</span><br><span class="line">  <span class="comment">//持有接收者对象</span></span><br><span class="line">  <span class="keyword">private</span> Chef receiver;</span><br><span class="line">  <span class="comment">//持有订单对象</span></span><br><span class="line">  <span class="keyword">private</span> Order order;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">OrderCommand</span><span class="params">(Chef receiver, Order order)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.receiver = receiver;</span><br><span class="line">    <span class="built_in">this</span>.order = order;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(order.getTable() + <span class="string">&quot;号桌的订单：&quot;</span>);</span><br><span class="line">    Map&lt;String,Integer&gt; food = order.getFood();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//遍历map</span></span><br><span class="line">    <span class="keyword">for</span>(String name : food.keySet())&#123;</span><br><span class="line">      receiver.makeFood(name,food.get(name));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    System.out.println(order.getTable()+<span class="string">&quot;号桌的菜品准备完毕&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Invoker请求者类：服务员</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">waiter</span>&#123;</span><br><span class="line">  <span class="comment">//持有多个命令对象</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;Command&gt; commands = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Command&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCommand</span><span class="params">(Command cmd)</span>&#123;</span><br><span class="line">    <span class="comment">//将cmd对象存储到List集合中</span></span><br><span class="line">    commands.add(cmd);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//发起命令的功能</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">orderUp</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;订单来了&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(Command command : commands)&#123;</span><br><span class="line">      <span class="keyword">if</span>(command != <span class="literal">null</span>)&#123;</span><br><span class="line">        command.execute();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;</span><br><span class="line">  psvm&#123;</span><br><span class="line">    <span class="type">Order</span> <span class="variable">order1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">    order1.setTable(<span class="number">1</span>);</span><br><span class="line">    order1.setFood(<span class="string">&quot;板烧鸡腿堡&quot;</span>,<span class="number">1</span>);</span><br><span class="line">    order1.setFood(<span class="string">&quot;可乐&quot;</span>,<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">Chef</span> <span class="variable">receiver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chef</span>();</span><br><span class="line">    <span class="type">OrderCommand</span> <span class="variable">cmd1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderCommand</span>(receiver,cmd1);</span><br><span class="line">    <span class="type">Waiter</span> <span class="variable">invoker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Waiter</span>();</span><br><span class="line">    </span><br><span class="line">    invoker.setCommand(cmd1);</span><br><span class="line">    </span><br><span class="line">    invoker.orderUp();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>命令模式优点：</p>
<ul>
<li>降低系统耦合度，将调用操作的对象与实现该操作的对象解耦。</li>
<li>增删命令方便。</li>
<li>可以实现宏命令，即可以与组合模式结合，将多个命令装配成一个组合命令。</li>
<li>可以和备忘录模式结合，实现命令的撤销与恢复。</li>
</ul>
<p>缺点：</p>
<ul>
<li>可能导致系统有过多的具体命令类。</li>
<li>系统结构更加复杂。</li>
</ul>
<p>使用场景：</p>
<ul>
<li>系统需要将请求调用者和请求接收者解耦，使得调用者和接受者不直接交互。</li>
<li>系统需要在不同的时间指定请求，将请求排队和执行请求。</li>
<li>系统需要支持命令的撤销undo和恢复redo操作。</li>
</ul>
<h3 id="Memento-备忘录模式"><a href="#Memento-备忘录模式" class="headerlink" title="Memento 备忘录模式"></a>Memento 备忘录模式</h3><p>意图：又叫快照模式，在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便以后当需要时能将该对象恢复到原先保存的状态。</p>
<p>备忘录模式分为两种：白箱备忘录和黑箱备忘录。</p>
<p>结构：</p>
<ul>
<li>Originator 发起人角色：记录当前时刻的内部状态，提供创建备忘录和恢复数据的功能。</li>
<li>Memento 备忘录角色：负责存储发起人的内部状态，在需要的时候提供给发起人。</li>
<li>Caretaker 管理者角色：对备忘录进行管理。提供保存与获取备忘录的功能，但不能对备忘录的内容进行访问与修改。</li>
</ul>
<h4 id="白箱备忘录"><a href="#白箱备忘录" class="headerlink" title="白箱备忘录"></a>白箱备忘录</h4><p>备忘录角色对任何对象都提供一个接口，即宽接口，备忘录角色的内部所存储的状态对所有对象公开。</p>
<p>以游戏角色为例，角色有不同属性，存档后随时可以恢复到之前的属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Originator 发起人类：游戏角色</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GameRole</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> vit;<span class="comment">//生命力</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> atk;<span class="comment">//攻击力</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> def;<span class="comment">//防御力</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//get set 方法</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//初始化内部状态的方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initState</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.vit = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">this</span>.atk = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">this</span>.def = <span class="number">100</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//战斗的方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fight</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.vit = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.atk = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.def = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//保存角色状态的方法</span></span><br><span class="line">  <span class="keyword">public</span> RoleStateMemento <span class="title function_">saveState</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RoleStateMemento</span>(vit,atk,def);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//恢复角色状态的方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recoverState</span><span class="params">(RoleStateMemento roleStateMemento)</span>&#123;</span><br><span class="line">    <span class="comment">//将备忘录对象中的状态赋值给当前对象</span></span><br><span class="line">    <span class="built_in">this</span>.vit = roleStateMemento.getVit();</span><br><span class="line">    <span class="built_in">this</span>.atk = roleStateMemento.getAtk();</span><br><span class="line">    <span class="built_in">this</span>.def = roleStateMemento.getDef();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//展示状态的方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stateDisplay</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;角色生命力：&quot;</span>+vit);</span><br><span class="line">    System.out.println(<span class="string">&quot;角色攻击力：&quot;</span>+atk);</span><br><span class="line">    System.out.println(<span class="string">&quot;角色防御力：&quot;</span>+def);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Memento 备忘录对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleStateMemento</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> vit;<span class="comment">//生命力</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> atk;<span class="comment">//攻击力</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> def;<span class="comment">//防御力</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//get set 有参无参构造方法 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Caretaker 备忘录管理对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleStateCaretaker</span>&#123;</span><br><span class="line">  <span class="comment">//声明RoleStateMemento类型的变量</span></span><br><span class="line">  <span class="keyword">private</span> RoleStateMemento roleStateMemento;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//无参构造 set方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;</span><br><span class="line">  psvm&#123;</span><br><span class="line">    <span class="comment">//创建游戏对象</span></span><br><span class="line">    <span class="type">GameRole</span> <span class="variable">gameRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GameRole</span>();</span><br><span class="line">    gameRole.initState();</span><br><span class="line">    gameRole.stateDisplay();</span><br><span class="line">    <span class="comment">//备份角色状态</span></span><br><span class="line">    <span class="comment">//创建管理者对象</span></span><br><span class="line">    <span class="type">RoleStateCaretaker</span> <span class="variable">roleStateCaretaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleStateCaretaker</span>();</span><br><span class="line">    roleStateCaretaker.setRoleStateMemento(gameRole.saveState());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//打BOSS之后属性清零</span></span><br><span class="line">    gameRole.fight();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//恢复之前的状态</span></span><br><span class="line">    gameRole.recoverState(roleStateCaretaker.getRoleStateMemento());</span><br><span class="line">    gameRole.stateDisplay();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>白箱备忘录模式是破坏封装性的。</p>
<h4 id="黑箱备忘录"><a href="#黑箱备忘录" class="headerlink" title="黑箱备忘录"></a>黑箱备忘录</h4><p>备忘录角色对发起人对象提供一个宽接口，而为其他对象提供一个窄接口。在Java中，实现双重接口的方法就是<strong>将备忘录类设计成发起人类的成员内部类。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备忘录接口 对外提供窄接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Memento</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Caretaker 备忘录管理对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleStateCaretaker</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Memento memento;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//get set方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Originator 发起人类：游戏角色</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GameRole</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> vit;<span class="comment">//生命力</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> atk;<span class="comment">//攻击力</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> def;<span class="comment">//防御力</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//get set 方法</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//初始化内部状态的方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initState</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.vit = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">this</span>.atk = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">this</span>.def = <span class="number">100</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//战斗的方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fight</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.vit = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.atk = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.def = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//保存角色状态的方法</span></span><br><span class="line">  <span class="keyword">public</span> Memento <span class="title function_">saveState</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RoleStateMemento</span>(vit,atk,def);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//恢复角色状态的方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recoverState</span><span class="params">(Memento memento)</span>&#123;</span><br><span class="line">    <span class="type">RoleStateMemento</span> <span class="variable">roleStateMemento</span> <span class="operator">=</span> (RoleStateMemento) memento;</span><br><span class="line">    <span class="comment">//将备忘录对象中的状态赋值给当前对象</span></span><br><span class="line">    <span class="built_in">this</span>.vit = roleStateMemento.getVit();</span><br><span class="line">    <span class="built_in">this</span>.atk = roleStateMemento.getAtk();</span><br><span class="line">    <span class="built_in">this</span>.def = roleStateMemento.getDef();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//展示状态的方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stateDisplay</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;角色生命力：&quot;</span>+vit);</span><br><span class="line">    System.out.println(<span class="string">&quot;角色攻击力：&quot;</span>+atk);</span><br><span class="line">    System.out.println(<span class="string">&quot;角色防御力：&quot;</span>+def);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//内部类</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">RoleStateMemento</span> <span class="keyword">implements</span> <span class="title class_">Memento</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> vit;<span class="comment">//生命力</span></span><br><span class="line">  	<span class="keyword">private</span> <span class="type">int</span> atk;<span class="comment">//攻击力</span></span><br><span class="line">  	<span class="keyword">private</span> <span class="type">int</span> def;<span class="comment">//防御力</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//无参有参构造 get set</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;</span><br><span class="line">  psvm&#123;</span><br><span class="line">    <span class="comment">//创建游戏对象</span></span><br><span class="line">    <span class="type">GameRole</span> <span class="variable">gameRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GameRole</span>();</span><br><span class="line">    gameRole.initState();</span><br><span class="line">    gameRole.stateDisplay();</span><br><span class="line">    <span class="comment">//备份角色状态</span></span><br><span class="line">    <span class="comment">//创建管理者对象</span></span><br><span class="line">    <span class="type">RoleStateCaretaker</span> <span class="variable">roleStateCaretaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleStateCaretaker</span>();</span><br><span class="line">    roleStateCaretaker.setMemento(gameRole.saveState());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//打BOSS之后属性清零</span></span><br><span class="line">    gameRole.fight();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//恢复之前的状态</span></span><br><span class="line">    gameRole.recoverState(roleStateCaretaker.getMemento());</span><br><span class="line">    gameRole.stateDisplay();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>备忘录模式优点：</p>
<ul>
<li>提供了一种可以恢复状态的机制。当用户需要时能够方便的将数据恢复到某个历史的状态。</li>
<li>实现了内部状态的封装。除了创建它的发起人之外，其他对象不能访问这些状态信息。（黑箱备忘录）</li>
<li>简化了发起人类，发起人不需要管理和保存其内部状态的各个备份，所有状态信息都保存在备忘录中，并由管理者进行管理。</li>
</ul>
<p>缺点：</p>
<ul>
<li>资源消耗大。</li>
</ul>
<p>使用场景：</p>
<ul>
<li>需要保存与恢复数据的场景，如玩游戏的存档功能。</li>
<li>需要提供一个可回滚操作的场景，如Word、PhotoShop、IDEA等。</li>
</ul>
<h3 id="Observer-观察者模式"><a href="#Observer-观察者模式" class="headerlink" title="Observer 观察者模式"></a>Observer 观察者模式</h3><p>意图：又叫发布-订阅模式，定义对象间的一种一对多的依赖关系，让多个观察者对象同时监听某一个主题对象。这个主题对象在状态变化时，会通知所有的观察者对象，使它们能够自动更新。</p>
<p>结构：</p>
<ul>
<li>Subject 抽象主题（抽象被观察者）：把所有观察者对象保存在一个集合里，每个主题可以有任意数量的观察者，抽象主题提供一个接口，可以增删观察者对象。</li>
<li>ConcreteSubject 具体主题（具体被观察者）：该角色将有关状态存入具体观察者对象，在具体主题的内部状态发生改变时，给所有观察者发送通知。</li>
<li>Observer 抽象观察者：定义一个更新接口，使得在得到主题更改时能更新自己。</li>
<li>ConcreteObserver 具体观察者：实现了抽象观察者的更新接口。</li>
</ul>
<p>以微信公众号为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//抽象主题角色</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line">  <span class="comment">//添加订阅者（观察者）</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">(Observer observer)</span>;</span><br><span class="line">  <span class="comment">//删除订阅者</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">(Observer observer)</span>;</span><br><span class="line">  <span class="comment">//通知订阅者更新消息</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体主题类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubscriptionSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line">  <span class="comment">//定义一个集合存储多个观察者对象</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;Observer&gt; weChatUserList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">(Observer observer)</span>&#123;</span><br><span class="line">    weChatUserList.add(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">(Observer observer)</span>&#123;</span><br><span class="line">    weChatUserList.remove(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span>&#123;</span><br><span class="line">    <span class="comment">//遍历集合</span></span><br><span class="line">    <span class="keyword">for</span>(Observer observer : weChatUserList)&#123;</span><br><span class="line">			<span class="comment">//调用观察者对象中的update方法</span></span><br><span class="line">      observer.update(message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//抽象观察者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体观察者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatUser</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="comment">//有参构造</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span>&#123;</span><br><span class="line">    System.out.println(name + <span class="string">&quot;-&quot;</span> + message);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;</span><br><span class="line">  psvm&#123;</span><br><span class="line">    <span class="comment">//创建公众号对象</span></span><br><span class="line">    <span class="type">SubscriptionSubject</span> <span class="variable">subject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubscriptionSubject</span>();</span><br><span class="line">    <span class="comment">//订阅公众号</span></span><br><span class="line">    subject.attach(<span class="keyword">new</span> <span class="title class_">wechatUser</span>(<span class="string">&quot;Ye&quot;</span>));</span><br><span class="line">    subject.attach(<span class="keyword">new</span> <span class="title class_">wechatUser</span>(<span class="string">&quot;Jisoo&quot;</span>));</span><br><span class="line">    <span class="comment">//公众号更新 发出消息给观察者</span></span><br><span class="line">    subject.notify(<span class="string">&quot;new article updated...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>观察者模式优点：</p>
<ul>
<li>降低了目标和观察者之间的耦合关系。</li>
<li>主题对象发送通知，所有注册的观察者都会收到信息，可以实现广播机制。</li>
</ul>
<p>缺点：</p>
<ul>
<li>如果观察者非常多，那么发送通知会很耗时。</li>
<li>如果主题对象有循环依赖的话，会导致系统崩溃。</li>
</ul>
<p>使用场景：</p>
<ul>
<li>对象间存在一对多关系，一个对象的状态发生改变会影响其他对象。</li>
<li>当一个抽象模型有两个方面，其中一个方面依赖于另一方面时。</li>
</ul>

</div> 

<script>
    window.onload = detectors();
</script>
    <div class="post-footer">
    <div class="h-line-primary"></div>
    <nav class="post-nav">
        <div class="prev-item">
           
        </div>
        <div class="next-item">
            
                <div class="icon arrow-right"></div>
                <div class="post-link">
                  <a href="/2022/03/14/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E6%A8%A1%E7%89%88+%E7%AD%96%E7%95%A5+%E8%B4%A3%E4%BB%BB%E9%93%BE/">Next</a>  
                </div>  
            
        </div>
    </nav>
</div>

  
</article>
        </div>
      </div>
      
      <div class="footer">
    <div class="flex-container">
        <div class="footer-text">
            
            
                Ye Yang | 
            
            
                Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & <a target="_blank" rel="noopener" href="https://hexo.io/">Frame</a>
                
        </div>
    </div>
</div>

    </div>

  </body>
</html>
